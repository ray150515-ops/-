<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ® Minecraftæ°¸ä¹…ç¤¾åŒº | å¯å‘å¸–ç‰ˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --mc-green: #3b8526;
            --mc-dark: #1a2c1a;
            --mc-light: #2d4a2d;
            --java-red: #e74c3c;
            --bedrock-blue: #3498db;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--mc-dark); color: white; min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        
        /* å¤´éƒ¨ */
        header { background: rgba(26,44,26,0.9); padding: 15px 0; border-bottom: 3px solid var(--mc-green); }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 10px; }
        .logo i { color: var(--mc-green); font-size: 2rem; }
        .logo h1 { font-size: 1.5rem; }
        
        /* æŒ‰é’® */
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; transition: 0.3s; }
        .btn-primary { background: var(--mc-green); color: white; }
        .btn-primary:hover { background: #5ba34e; }
        .btn-small { padding: 5px 10px; font-size: 0.9rem; }
        
        /* é€‰é¡¹å¡ */
        .tabs { display: flex; gap: 5px; margin: 20px 0; }
        .tab { padding: 10px 20px; background: rgba(255,255,255,0.1); border: none; color: white; cursor: pointer; }
        .tab.active { background: var(--mc-green); }
        
        /* å†…å®¹åŒº */
        .content-area { display: none; }
        .content-area.active { display: block; }
        
        /* è¡¨å• */
        .form-container { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px; margin: 20px 0; }
        .form-group { margin-bottom: 15px; }
        .form-control { width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid #444; border-radius: 5px; color: white; }
        textarea.form-control { min-height: 100px; }
        
        /* å¸–å­/æœåŠ¡å™¨å¡ç‰‡ */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; margin: 20px 0; }
        .card { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; border: 1px solid #444; }
        .card-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .badge { padding: 3px 10px; border-radius: 15px; font-size: 0.8rem; }
        .badge-java { background: rgba(231,76,60,0.2); color: #e74c3c; }
        .badge-bedrock { background: rgba(52,152,219,0.2); color: #3498db; }
        
        /* æ¨¡æ€æ¡† */
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); z-index: 1000; }
        .modal-content { background: var(--mc-dark); padding: 20px; border-radius: 10px; max-width: 400px; margin: 100px auto; border: 2px solid var(--mc-green); }
        
        /* æç¤º */
        .toast { position: fixed; bottom: 20px; right: 20px; background: var(--mc-green); color: white; padding: 10px 20px; border-radius: 5px; display: none; z-index: 1001; }
        
        @media (max-width: 768px) {
            .header-content { flex-direction: column; gap: 10px; }
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-cube"></i>
                    <h1>Minecraftç¤¾åŒº</h1>
                </div>
                <div style="display:flex;align-items:center;gap:10px;">
                    <div id="userInfo">
                        <span id="userName">æ¸¸å®¢</span>
                    </div>
                    <button class="btn btn-primary" onclick="toggleLoginModal()">
                        <i class="fas fa-user"></i>ç™»å½•
                    </button>
                </div>
            </div>
        </header>

        <main>
            <!-- ç»Ÿè®¡ -->
            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px,1fr));gap:10px;margin:20px 0;">
                <div style="background:rgba(255,255,255,0.05);padding:15px;border-radius:8px;text-align:center;">
                    <div style="color:var(--mc-green);font-size:1.5rem;"><i class="fas fa-comments"></i></div>
                    <h3 id="postsCount">0</h3>
                    <p>å¸–å­</p>
                </div>
                <div style="background:rgba(255,255,255,0.05);padding:15px;border-radius:8px;text-align:center;">
                    <div style="color:var(--mc-green);font-size:1.5rem;"><i class="fas fa-server"></i></div>
                    <h3 id="serversCount">0</h3>
                    <p>æœåŠ¡å™¨</p>
                </div>
            </div>

            <!-- é€‰é¡¹å¡ -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('posts')">æµè§ˆå¸–å­</button>
                <button class="tab" onclick="switchTab('servers')">æœåŠ¡å™¨åˆ—è¡¨</button>
                <button class="tab" onclick="switchTab('create')">å‘å¸ƒå†…å®¹</button>
            </div>

            <!-- å¸–å­åŒº -->
            <div id="postsArea" class="content-area active">
                <div style="margin:20px 0;">
                    <button class="btn btn-primary" onclick="switchTab('create')">
                        <i class="fas fa-plus"></i> å‘æ–°å¸–
                    </button>
                </div>
                <div class="grid" id="postsGrid">
                    <!-- åŠ¨æ€åŠ è½½ -->
                </div>
            </div>

            <!-- æœåŠ¡å™¨åŒº -->
            <div id="serversArea" class="content-area">
                <div style="margin:20px 0;">
                    <button class="btn btn-primary" onclick="switchTab('create')">
                        <i class="fas fa-plus"></i> æ·»åŠ æœåŠ¡å™¨
                    </button>
                </div>
                <div class="grid" id="serversGrid">
                    <!-- åŠ¨æ€åŠ è½½ -->
                </div>
            </div>

            <!-- å‘å¸ƒåŒº -->
            <div id="createArea" class="content-area">
                <div class="form-container">
                    <h3 style="margin-bottom:20px;"><i class="fas fa-plus-circle"></i> å‘å¸ƒå†…å®¹</h3>
                    
                    <div class="form-group">
                        <select id="contentType" class="form-control" onchange="toggleForm()">
                            <option value="post">å‘å¸ƒå¸–å­</option>
                            <option value="server">æ·»åŠ æœåŠ¡å™¨</option>
                        </select>
                    </div>

                    <!-- å¸–å­è¡¨å• -->
                    <div id="postForm">
                        <div class="form-group">
                            <input type="text" id="postTitle" class="form-control" placeholder="å¸–å­æ ‡é¢˜">
                        </div>
                        <div class="form-group">
                            <textarea id="postContent" class="form-control" placeholder="å¸–å­å†…å®¹..."></textarea>
                        </div>
                    </div>

                    <!-- æœåŠ¡å™¨è¡¨å• -->
                    <div id="serverForm" style="display:none;">
                        <div class="form-group">
                            <input type="text" id="serverName" class="form-control" placeholder="æœåŠ¡å™¨åç§°">
                        </div>
                        <div class="form-group">
                            <input type="text" id="serverIP" class="form-control" placeholder="IPåœ°å€:ç«¯å£ (å¦‚: play.example.com:25565)">
                        </div>
                        <div class="form-group">
                            <textarea id="serverDesc" class="form-control" placeholder="æœåŠ¡å™¨æè¿°..."></textarea>
                        </div>
                    </div>

                    <div class="form-group">
                        <label style="display:block;margin-bottom:5px;">æ¸¸æˆç‰ˆæœ¬ï¼š</label>
                        <div style="display:flex;gap:10px;">
                            <label><input type="radio" name="platform" value="java" checked> Javaç‰ˆ</label>
                            <label><input type="radio" name="platform" value="bedrock"> åŸºå²©ç‰ˆ</label>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="submitContent()" style="width:100%;">
                        <i class="fas fa-paper-plane"></i> å‘å¸ƒ
                    </button>
                </div>
            </div>
        </main>

        <!-- ç™»å½•æ¨¡æ€æ¡† -->
        <div class="modal" id="loginModal">
            <div class="modal-content">
                <h3 style="margin-bottom:20px;"><i class="fas fa-sign-in-alt"></i> ç™»å½•/æ³¨å†Œ</h3>
                
                <div class="form-group">
                    <input type="text" id="username" class="form-control" placeholder="ç”¨æˆ·å" value="ç©å®¶">
                </div>
                <div class="form-group">
                    <input type="password" id="password" class="form-control" placeholder="å¯†ç " value="123456">
                </div>
                
                <button class="btn btn-primary" onclick="login()" style="width:100%;margin-bottom:10px;">
                    ç™»å½•
                </button>
                
                <button class="btn" onclick="register()" style="width:100%;background:#666;color:white;">
                    æ³¨å†Œ
                </button>
                
                <p style="text-align:center;margin-top:15px;color:#888;font-size:0.9rem;">
                    <small>æµ‹è¯•è´¦å·ï¼šç©å®¶ / 123456</small>
                </p>
            </div>
        </div>

        <div class="toast" id="toast"></div>
    </div>

    <script>
        // ==================== æ ¸å¿ƒé…ç½® ====================
        const API_BASE = '/api';  // Cloudflare Workerè·¯å¾„
        let currentUser = null;
        let posts = [];
        let servers = [];

        // ==================== é¡µé¢åˆå§‹åŒ– ====================
        window.onload = function() {
            // æ£€æŸ¥æœ¬åœ°ç”¨æˆ·
            const user = localStorage.getItem('mc_user');
            if (user) {
                currentUser = JSON.parse(user);
                updateUserUI();
            }
            
            // åŠ è½½æ•°æ®
            loadData();
        };

        // ==================== è¾…åŠ©å‡½æ•° ====================
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.background = type === 'error' ? '#e74c3c' : '#3b8526';
            toast.style.display = 'block';
            setTimeout(() => toast.style.display = 'none', 3000);
        }

        function toggleLoginModal() {
            const modal = document.getElementById('loginModal');
            modal.style.display = modal.style.display === 'block' ? 'none' : 'block';
        }

        function switchTab(tabName) {
            // æ›´æ–°é€‰é¡¹å¡
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab')[['posts','servers','create'].indexOf(tabName)].classList.add('active');
            
            // æ˜¾ç¤ºå¯¹åº”åŒºåŸŸ
            document.querySelectorAll('.content-area').forEach(area => area.classList.remove('active'));
            document.getElementById(tabName + 'Area').classList.add('active');
        }

        function toggleForm() {
            const type = document.getElementById('contentType').value;
            document.getElementById('postForm').style.display = type === 'post' ? 'block' : 'none';
            document.getElementById('serverForm').style.display = type === 'server' ? 'block' : 'none';
        }

        // ==================== ç”¨æˆ·ç³»ç»Ÿ ====================
        async function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username) {
                showToast('è¯·è¾“å…¥ç”¨æˆ·å', 'error');
                return;
            }
            
            // ç›´æ¥è®¾ç½®ç”¨æˆ·ï¼ˆç®€åŒ–ç‰ˆï¼Œå®é™…åº”è¯¥è°ƒç”¨APIï¼‰
            currentUser = {
                username: username || 'ç©å®¶',
                id: Date.now()
            };
            
            localStorage.setItem('mc_user', JSON.stringify(currentUser));
            updateUserUI();
            toggleLoginModal();
            showToast(`æ¬¢è¿å›æ¥ï¼Œ${currentUser.username}ï¼`);
            
            // æ¸…é™¤å¯†ç æ¡†
            document.getElementById('password').value = '';
        }

        async function register() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                showToast('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ', 'error');
                return;
            }
            
            if (password.length < 6) {
                showToast('å¯†ç è‡³å°‘6ä½', 'error');
                return;
            }
            
            // ç›´æ¥æ³¨å†Œï¼ˆç®€åŒ–ç‰ˆï¼‰
            currentUser = {
                username,
                id: Date.now(),
                registered: new Date().toISOString()
            };
            
            localStorage.setItem('mc_user', JSON.stringify(currentUser));
            updateUserUI();
            toggleLoginModal();
            showToast('æ³¨å†ŒæˆåŠŸï¼');
        }

        function updateUserUI() {
            const userInfo = document.getElementById('userInfo');
            const loginBtn = document.querySelector('[onclick="toggleLoginModal()"]');
            
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.username;
                loginBtn.innerHTML = '<i class="fas fa-sign-out-alt"></i>é€€å‡º';
                loginBtn.onclick = logout;
            } else {
                document.getElementById('userName').textContent = 'æ¸¸å®¢';
                loginBtn.innerHTML = '<i class="fas fa-user"></i>ç™»å½•';
                loginBtn.onclick = toggleLoginModal;
            }
        }

        function logout() {
            localStorage.removeItem('mc_user');
            currentUser = null;
            updateUserUI();
            showToast('å·²é€€å‡ºç™»å½•');
        }

        // ==================== æ•°æ®åŠ è½½ ====================
        async function loadData() {
            try {
                // å°è¯•ä»APIåŠ è½½
                const postsRes = await fetch(API_BASE + '/posts');
                if (postsRes.ok) {
                    posts = await postsRes.json();
                } else {
                    loadMockPosts();
                }
                
                const serversRes = await fetch(API_BASE + '/servers');
                if (serversRes.ok) {
                    servers = await serversRes.json();
                } else {
                    loadMockServers();
                }
                
            } catch (error) {
                console.log('ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®');
                loadMockPosts();
                loadMockServers();
            }
            
            renderPosts();
            renderServers();
        }

        function loadMockPosts() {
            posts = [
                {
                    id: 1,
                    title: 'æ¬¢è¿æ¥åˆ°Minecraftç¤¾åŒºï¼',
                    content: 'è¿™æ˜¯ä¸€ä¸ªå¯ä»¥æ°¸ä¹…ä¿å­˜æ•°æ®çš„ç¤¾åŒºå¹³å°ï¼ŒåŸºäºCloudflare Pagesæ„å»ºã€‚',
                    author: 'ç®¡ç†å‘˜',
                    platform: 'java',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    title: 'çº¢çŸ³ç”µè·¯åŸºç¡€æ•™ç¨‹',
                    content: 'ä»Šå¤©æ•™å¤§å®¶å¦‚ä½•åˆ¶ä½œç®€å•çš„çº¢çŸ³ç”µè·¯ï¼Œé€‚åˆæ–°æ‰‹å­¦ä¹ ã€‚',
                    author: 'çº¢çŸ³çˆ±å¥½è€…',
                    platform: 'java',
                    createdAt: new Date(Date.now() - 3600000).toISOString()
                }
            ];
        }

        function loadMockServers() {
            servers = [
                {
                    id: 1,
                    name: 'ç¤ºä¾‹ç”Ÿå­˜æœåŠ¡å™¨',
                    ip: 'play.example.com:25565',
                    description: 'è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æœåŠ¡å™¨ï¼Œæ¬¢è¿åŠ å…¥ï¼',
                    author: 'ç¤ºä¾‹',
                    platform: 'java',
                    createdAt: new Date().toISOString()
                }
            ];
        }

        // ==================== æ¸²æŸ“å‡½æ•° ====================
        function renderPosts() {
            const container = document.getElementById('postsGrid');
            if (!container) return;
            
            document.getElementById('postsCount').textContent = posts.length;
            
            if (posts.length === 0) {
                container.innerHTML = '<div style="text-align:center;padding:20px;color:#888;">è¿˜æ²¡æœ‰å¸–å­ï¼Œå‘å¸ƒç¬¬ä¸€ä¸ªå§ï¼</div>';
                return;
            }
            
            container.innerHTML = posts.map(post => `
                <div class="card">
                    <div class="card-header">
                        <strong>${post.author}</strong>
                        <span class="badge ${post.platform === 'java' ? 'badge-java' : 'badge-bedrock'}">
                            ${post.platform === 'java' ? 'Javaç‰ˆ' : 'åŸºå²©ç‰ˆ'}
                        </span>
                    </div>
                    <h4>${post.title}</h4>
                    <p style="margin:10px 0;color:#ccc;">${post.content}</p>
                    <div style="font-size:0.9rem;color:#888;">
                        ${new Date(post.createdAt).toLocaleDateString('zh-CN')}
                    </div>
                </div>
            `).join('');
        }

        function renderServers() {
            const container = document.getElementById('serversGrid');
            if (!container) return;
            
            document.getElementById('serversCount').textContent = servers.length;
            
            if (servers.length === 0) {
                container.innerHTML = '<div style="text-align:center;padding:20px;color:#888;">è¿˜æ²¡æœ‰æœåŠ¡å™¨ï¼Œæ·»åŠ ä¸€ä¸ªå§ï¼</div>';
                return;
            }
            
            container.innerHTML = servers.map(server => `
                <div class="card">
                    <div class="card-header">
                        <strong>${server.name}</strong>
                        <span class="badge ${server.platform === 'java' ? 'badge-java' : 'badge-bedrock'}">
                            ${server.platform === 'java' ? 'Javaç‰ˆ' : 'åŸºå²©ç‰ˆ'}
                        </span>
                    </div>
                    <div style="background:#000;padding:8px;border-radius:4px;margin:10px 0;font-family:monospace;">
                        ${server.ip}
                    </div>
                    <p style="margin:10px 0;color:#ccc;">${server.description}</p>
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <span style="font-size:0.9rem;color:#888;">${server.author}</span>
                        <button class="btn btn-small" onclick="copyIP('${server.ip}')">
                            <i class="fas fa-copy"></i> å¤åˆ¶IP
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ==================== å‘å¸ƒå†…å®¹ ====================
        async function submitContent() {
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            if (!currentUser) {
                showToast('è¯·å…ˆç™»å½•', 'error');
                toggleLoginModal();
                return;
            }

            const type = document.getElementById('contentType').value;
            const platform = document.querySelector('input[name="platform"]:checked').value;
            const author = currentUser.username;

            if (type === 'post') {
                const title = document.getElementById('postTitle').value.trim();
                const content = document.getElementById('postContent').value.trim();

                if (!title || !content) {
                    showToast('è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹', 'error');
                    return;
                }

                try {
                    // å°è¯•è°ƒç”¨API
                    const response = await fetch(API_BASE + '/posts', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            title,
                            content,
                            platform,
                            author
                        })
                    });

                    if (response.ok) {
                        const newPost = await response.json();
                        posts.unshift(newPost);
                        renderPosts();
                        clearForm();
                        showToast('å¸–å­å‘å¸ƒæˆåŠŸï¼');
                        switchTab('posts');
                    } else {
                        // APIå¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨
                        saveToLocalStorage();
                    }
                } catch (error) {
                    console.log('APIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨');
                    saveToLocalStorage();
                }

                function saveToLocalStorage() {
                    const newPost = {
                        id: Date.now(),
                        title,
                        content,
                        platform,
                        author,
                        createdAt: new Date().toISOString()
                    };
                    
                    posts.unshift(newPost);
                    localStorage.setItem('mc_posts', JSON.stringify(posts));
                    renderPosts();
                    clearForm();
                    showToast('å¸–å­å·²ä¿å­˜åˆ°æœ¬åœ°');
                    switchTab('posts');
                }

            } else {
                // å‘å¸ƒæœåŠ¡å™¨
                const name = document.getElementById('serverName').value.trim();
                const ip = document.getElementById('serverIP').value.trim();
                const description = document.getElementById('serverDesc').value.trim();

                if (!name || !ip || !description) {
                    showToast('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'error');
                    return;
                }

                try {
                    const response = await fetch(API_BASE + '/servers', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            name,
                            ip,
                            description,
                            platform,
                            author
                        })
                    });

                    if (response.ok) {
                        const newServer = await response.json();
                        servers.unshift(newServer);
                        renderServers();
                        clearForm();
                        showToast('æœåŠ¡å™¨æ·»åŠ æˆåŠŸï¼');
                        switchTab('servers');
                    } else {
                        saveServerToLocal();
                    }
                } catch (error) {
                    saveServerToLocal();
                }

                function saveServerToLocal() {
                    const newServer = {
                        id: Date.now(),
                        name,
                        ip,
                        description,
                        platform,
                        author,
                        createdAt: new Date().toISOString()
                    };
                    
                    servers.unshift(newServer);
                    localStorage.setItem('mc_servers', JSON.stringify(servers));
                    renderServers();
                    clearForm();
                    showToast('æœåŠ¡å™¨å·²ä¿å­˜åˆ°æœ¬åœ°');
                    switchTab('servers');
                }
            }
        }

        function clearForm() {
            document.getElementById('postTitle').value = '';
            document.getElementById('postContent').value = '';
            document.getElementById('serverName').value = '';
            document.getElementById('serverIP').value = '';
            document.getElementById('serverDesc').value = '';
        }

        function copyIP(ip) {
            navigator.clipboard.writeText(ip).then(() => {
                showToast('IPå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }).catch(() => {
                // å…¼å®¹æ—§æµè§ˆå™¨
                const input = document.createElement('input');
                input.value = ip;
                document.body.appendChild(input);
                input.select();
                document.execCommand('copy');
                document.body.removeChild(input);
                showToast('IPå·²å¤åˆ¶');
            });
        }

        // åˆå§‹åŒ–æœ¬åœ°æ•°æ®
        const localPosts = localStorage.getItem('mc_posts');
        const localServers = localStorage.getItem('mc_servers');
        
        if (localPosts) {
            try {
                posts = JSON.parse(localPosts);
            } catch (e) {}
        }
        
        if (localServers) {
            try {
                servers = JSON.parse(localServers);
            } catch (e) {}
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ¸²æŸ“
        setTimeout(() => {
            renderPosts();
            renderServers();
        }, 100);
    </script>
</body>
</html>