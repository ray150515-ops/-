<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ® Minecraftæ°¸ä¹…ç¤¾åŒº | æ‚¨çš„æ•°æ®åº“å·²å°±ç»ª</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --mc-green: #3b8526;
            --mc-dark: #1a2c1a;
            --mc-light: #2d4a2d;
            --java-red: #e74c3c;
            --bedrock-blue: #3498db;
            --supabase-green: #3ecf8e;
        }
        
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',sans-serif; }
        body { 
            background: linear-gradient(135deg, #0f1a0f 0%, #1a2c1a 100%);
            color:white; 
            min-height:100vh;
        }
        
        .container { max-width:1200px; margin:0 auto; padding:20px; }
        
        /* æˆåŠŸå¤´éƒ¨ */
        .success-header {
            background: linear-gradient(135deg, #1a2c1a, #2d4a2d);
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            text-align: center;
            border: 3px solid var(--mc-green);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .success-icon {
            font-size: 4rem;
            color: var(--supabase-green);
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .success-header h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #3b8526, #3ecf8e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .db-info {
            background: rgba(62, 207, 142, 0.1);
            border: 1px solid var(--supabase-green);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            word-break: break-all;
        }
        
        /* ä¸»è¦å†…å®¹ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
        }
        
        @media (max-width: 900px) {
            .main-content { grid-template-columns: 1fr; }
        }
        
        /* å‘å¸ƒè¡¨å• */
        .publish-box {
            background: rgba(26, 44, 26, 0.8);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid var(--mc-green);
            margin-bottom: 30px;
        }
        
        .form-group { margin-bottom: 20px; }
        .form-control {
            width: 100%;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            transition: 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--mc-green);
            box-shadow: 0 0 0 3px rgba(59,133,38,0.3);
        }
        
        textarea.form-control { min-height: 120px; resize: vertical; }
        
        /* æŒ‰é’® */
        .btn {
            padding: 15px 30px;
            background: var(--mc-green);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
        }
        
        .btn:hover {
            background: #5ba34e;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(59,133,38,0.4);
        }
        
        .btn-supabase {
            background: var(--supabase-green);
        }
        
        .btn-supabase:hover {
            background: #4cdb9d;
        }
        
        /* å†…å®¹å±•ç¤º */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .content-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: 0.3s;
        }
        
        .content-card:hover {
            transform: translateY(-5px);
            border-color: var(--mc-green);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }
        
        .badge-java {
            background: rgba(231,76,60,0.2);
            color: var(--java-red);
            border: 1px solid rgba(231,76,60,0.3);
        }
        
        .badge-bedrock {
            background: rgba(52,152,219,0.2);
            color: var(--bedrock-blue);
            border: 1px solid rgba(52,152,219,0.3);
        }
        
        /* ä¾§è¾¹æ  */
        .sidebar {
            background: rgba(26,44,26,0.8);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
            height: fit-content;
        }
        
        .stats-card {
            background: rgba(62,207,142,0.1);
            border: 1px solid var(--supabase-green);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .stats-card h3 {
            font-size: 2.5rem;
            color: var(--supabase-green);
            margin: 10px 0;
        }
        
        /* å®æ—¶æ´»åŠ¨ */
        .activity-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loader {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 30px 0;
        }
        
        .loader div {
            width: 12px;
            height: 12px;
            background: var(--mc-green);
            border-radius: 50%;
            animation: pulse 1.4s infinite ease-in-out both;
        }
        
        .loader div:nth-child(1) { animation-delay: -0.32s; }
        .loader div:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes pulse {
            0%, 80%, 100% { transform: scale(0); opacity: 0; }
            40% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æˆåŠŸå¤´éƒ¨ -->
        <div class="success-header">
            <div class="success-icon">
                <i class="fas fa-database"></i>
            </div>
            <h1>ğŸ® Minecraftç¤¾åŒºå·²è¿æ¥ï¼</h1>
            <p>æ‚¨çš„Supabaseæ•°æ®åº“æ­£åœ¨è¿è¡Œï¼Œæ•°æ®æ°¸ä¹…å­˜å‚¨</p>
            
            <div class="db-info">
                <div><strong>æ•°æ®åº“URL:</strong> isvyleujyxrjxvqrutrm.supabase.co</div>
                <div><strong>çŠ¶æ€:</strong> <span id="dbStatus">è¿æ¥ä¸­...</span></div>
            </div>
            
            <button class="btn btn-supabase" onclick="testConnection()">
                <i class="fas fa-plug"></i> æµ‹è¯•è¿æ¥
            </button>
        </div>

        <div class="main-content">
            <!-- å·¦ä¾§ä¸»å†…å®¹ -->
            <div>
                <!-- å‘å¸ƒåŒº -->
                <div class="publish-box">
                    <h2 style="margin-bottom:25px;text-align:center;">
                        <i class="fas fa-plus-circle"></i> å‘å¸ƒæ–°å†…å®¹
                    </h2>
                    
                    <div class="form-group">
                        <select id="contentType" class="form-control" onchange="toggleForm()">
                            <option value="post">å‘å¸ƒå¸–å­</option>
                            <option value="server">æ·»åŠ æœåŠ¡å™¨</option>
                        </select>
                    </div>

                    <div id="postForm">
                        <div class="form-group">
                            <input type="text" id="postTitle" class="form-control" placeholder="è¾“å…¥å¸–å­æ ‡é¢˜" value="æˆ‘çš„ç¬¬ä¸€ä¸ªMinecraftå¸–å­">
                        </div>
                        <div class="form-group">
                            <textarea id="postContent" class="form-control" placeholder="è¯¦ç»†æè¿°ä½ çš„å†…å®¹...">è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å¸–å­ï¼Œæ•°æ®å­˜å‚¨åœ¨Supabaseï¼</textarea>
                        </div>
                    </div>

                    <div id="serverForm" style="display:none;">
                        <div class="form-group">
                            <input type="text" id="serverName" class="form-control" placeholder="æœåŠ¡å™¨åç§°" value="æˆ‘çš„MinecraftæœåŠ¡å™¨">
                        </div>
                        <div class="form-group">
                            <input type="text" id="serverIP" class="form-control" placeholder="IPåœ°å€:ç«¯å£" value="play.myserver.com:25565">
                        </div>
                        <div class="form-group">
                            <textarea id="serverDesc" class="form-control" placeholder="æœåŠ¡å™¨æè¿°...">æ¬¢è¿åŠ å…¥æˆ‘ä»¬çš„ç”Ÿå­˜æœåŠ¡å™¨ï¼</textarea>
                        </div>
                    </div>

                    <div class="form-group">
                        <label style="display:block;margin-bottom:10px;color:#ccc;">æ¸¸æˆç‰ˆæœ¬ï¼š</label>
                        <div style="display:flex;gap:15px;">
                            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                                <input type="radio" name="platform" value="java" checked>
                                <span class="badge badge-java">Javaç‰ˆ</span>
                            </label>
                            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                                <input type="radio" name="platform" value="bedrock">
                                <span class="badge badge-bedrock">åŸºå²©ç‰ˆ</span>
                            </label>
                        </div>
                    </div>

                    <button class="btn" onclick="submitContent()">
                        <i class="fas fa-cloud-upload-alt"></i> å‘å¸ƒåˆ°æ•°æ®åº“
                    </button>
                </div>

                <!-- å¸–å­åˆ—è¡¨ -->
                <div>
                    <h2 style="margin-bottom:20px;">
                        <i class="fas fa-comments"></i> æœ€æ–°å¸–å­
                        <button class="btn" onclick="loadPosts()" style="width:auto;padding:10px 20px;float:right;">
                            <i class="fas fa-sync-alt"></i> åˆ·æ–°
                        </button>
                    </h2>
                    
                    <div id="postsLoading" class="loader"></div>
                    <div class="content-grid" id="postsGrid">
                        <!-- åŠ¨æ€åŠ è½½ -->
                    </div>
                </div>
                
                <!-- æœåŠ¡å™¨åˆ—è¡¨ -->
                <div style="margin-top:40px;">
                    <h2 style="margin-bottom:20px;">
                        <i class="fas fa-server"></i> æœåŠ¡å™¨åˆ—è¡¨
                        <button class="btn" onclick="loadServers()" style="width:auto;padding:10px 20px;float:right;">
                            <i class="fas fa-sync-alt"></i> åˆ·æ–°
                        </button>
                    </h2>
                    
                    <div id="serversLoading" class="loader"></div>
                    <div class="content-grid" id="serversGrid">
                        <!-- åŠ¨æ€åŠ è½½ -->
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ä¾§è¾¹æ  -->
            <div class="sidebar">
                <h3><i class="fas fa-chart-bar"></i> å®æ—¶ç»Ÿè®¡</h3>
                
                <div class="stats-card">
                    <i class="fas fa-database" style="font-size:2rem;color:var(--supabase-green);"></i>
                    <h3 id="postsCount">0</h3>
                    <p>æ€»å¸–å­æ•°</p>
                </div>
                
                <div class="stats-card">
                    <i class="fas fa-server" style="font-size:2rem;color:var(--supabase-green);"></i>
                    <h3 id="serversCount">0</h3>
                    <p>æœåŠ¡å™¨æ•°</p>
                </div>
                
                <h3 style="margin-top:30px;"><i class="fas fa-bolt"></i> å®æ—¶æ´»åŠ¨</h3>
                <div id="activityFeed">
                    <div class="activity-item">
                        <i class="fas fa-circle" style="color:var(--supabase-green);font-size:0.6rem;"></i>
                        <span>ç³»ç»Ÿå¯åŠ¨</span>
                    </div>
                </div>
                
                <h3 style="margin-top:30px;"><i class="fas fa-info-circle"></i> ä½¿ç”¨è¯´æ˜</h3>
                <div style="color:#ccc;font-size:0.9rem;line-height:1.5;">
                    <p>âœ… æ•°æ®æ°¸ä¹…å­˜å‚¨åœ¨Supabase</p>
                    <p>âœ… æ‰€æœ‰äººå®æ—¶å¯è§</p>
                    <p>âœ… æ— éœ€æ³¨å†Œç™»å½•</p>
                    <p>âœ… æ”¯æŒJava/åŸºå²©ç‰ˆ</p>
                </div>
                
                <button class="btn btn-supabase" onclick="openSupabaseConsole()" style="margin-top:20px;">
                    <i class="fas fa-external-link-alt"></i> æ‰“å¼€æ•°æ®åº“ç®¡ç†
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============ æ‚¨çš„Supabaseé…ç½® ============
        const SUPABASE_URL = 'https://isvyleujyxrjxvqrutrm.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlzdnlsZXVqeXhyanh2cXJ1dHJtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3NDYzNTUsImV4cCI6MjA4NTMyMjM1NX0.z_IGzIRjviUWNANVjrz6v1XqMD-j1AR1SxDZr6ACGeI';
        
        console.log('ğŸ¯ ä½¿ç”¨æ­£ç¡®çš„anon key:', SUPABASE_KEY.substring(0, 20) + '...');
        
        // åˆå§‹åŒ–Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        let currentUser = 'ç©å®¶_' + Math.floor(Math.random() * 10000);
        
        // ============ æ•°æ®åº“è¿æ¥æµ‹è¯• ============
        async function testConnection() {
            const statusEl = document.getElementById('dbStatus');
            statusEl.innerHTML = 'æµ‹è¯•ä¸­...';
            statusEl.style.color = '#3498db';
            
            try {
                // æµ‹è¯•æŸ¥è¯¢
                const { data, error } = await supabase
                    .from('posts')
                    .select('count', { count: 'exact', head: true });
                
                if (error) {
                    // å¦‚æœè¡¨ä¸å­˜åœ¨ï¼Œå°è¯•åˆ›å»º
                    if (error.code === '42P01') {
                        statusEl.innerHTML = 'è¡¨ä¸å­˜åœ¨ï¼Œæ­£åœ¨æ£€æŸ¥...';
                        await createTables();
                        return;
                    }
                    throw error;
                }
                
                statusEl.innerHTML = 'âœ… è¿æ¥æˆåŠŸï¼';
                statusEl.style.color = '#3ecf8e';
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                showActivity('æ•°æ®åº“è¿æ¥æˆåŠŸ', 'success');
                loadStats();
                
            } catch (error) {
                console.error('è¿æ¥å¤±è´¥:', error);
                statusEl.innerHTML = 'âŒ è¿æ¥å¤±è´¥: ' + error.message;
                statusEl.style.color = '#e74c3c';
                showActivity('è¿æ¥å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // ============ åˆ›å»ºè¡¨ï¼ˆå¦‚æœéœ€è¦ï¼‰ ============
        async function createTables() {
            try {
                // æ³¨æ„ï¼šå‰ç«¯ä¸èƒ½ç›´æ¥æ‰§è¡ŒCREATE TABLE
                // è¿™é‡Œåªèƒ½æç¤ºç”¨æˆ·å»Supabaseæ§åˆ¶å°æ‰§è¡ŒSQL
                const statusEl = document.getElementById('dbStatus');
                statusEl.innerHTML = 'è¯·å…ˆåœ¨Supabaseæ§åˆ¶å°æ‰§è¡ŒSQLåˆ›å»ºè¡¨';
                statusEl.style.color = '#f39c12';
                
                showActivity('éœ€è¦åˆ›å»ºæ•°æ®åº“è¡¨', 'warning');
                
            } catch (error) {
                console.error('åˆ›å»ºè¡¨å¤±è´¥:', error);
            }
        }
        
        // ============ é¡µé¢å‡½æ•° ============
        function toggleForm() {
            const type = document.getElementById('contentType').value;
            document.getElementById('postForm').style.display = type === 'post' ? 'block' : 'none';
            document.getElementById('serverForm').style.display = type === 'server' ? 'block' : 'none';
        }
        
        function openSupabaseConsole() {
            window.open('https://supabase.com/dashboard/project/isvyleujyxrjxvqrutrm', '_blank');
        }
        
        // ============ åŠ è½½æ•°æ® ============
        async function loadPosts() {
            const loadingEl = document.getElementById('postsLoading');
            const gridEl = document.getElementById('postsGrid');
            
            loadingEl.style.display = 'flex';
            gridEl.innerHTML = '';
            
            try {
                const { data, error, count } = await supabase
                    .from('posts')
                    .select('*', { count: 'exact' })
                    .order('created_at', { ascending: false })
                    .limit(20);
                
                if (error) throw error;
                
                // æ›´æ–°ç»Ÿè®¡
                document.getElementById('postsCount').textContent = count || 0;
                
                if (!data || data.length === 0) {
                    gridEl.innerHTML = `
                        <div class="content-card" style="grid-column:1/-1;text-align:center;padding:50px;">
                            <i class="fas fa-inbox" style="font-size:3rem;color:#666;margin-bottom:20px;"></i>
                            <h3>è¿˜æ²¡æœ‰å¸–å­</h3>
                            <p style="color:#888;margin-top:10px;">å‘å¸ƒç¬¬ä¸€ä¸ªå¸–å­å§ï¼</p>
                        </div>
                    `;
                    return;
                }
                
                gridEl.innerHTML = data.map(post => `
                    <div class="content-card">
                        <div class="card-header">
                            <div style="font-weight:bold;color:#3ecf8e;">${post.author || 'ç©å®¶'}</div>
                            <span class="badge ${post.platform === 'java' ? 'badge-java' : 'badge-bedrock'}">
                                ${post.platform === 'java' ? 'Javaç‰ˆ' : 'åŸºå²©ç‰ˆ'}
                            </span>
                        </div>
                        <h3 style="margin-bottom:10px;">${post.title}</h3>
                        <p style="color:#ccc;line-height:1.6;">${post.content}</p>
                        <div style="margin-top:15px;padding-top:15px;border-top:1px solid rgba(255,255,255,0.1);">
                            <div style="display:flex;justify-content:space-between;color:#888;font-size:0.9rem;">
                                <span>${formatDate(post.created_at)}</span>
                                <span>#${post.id}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                showActivity(`åŠ è½½äº† ${data.length} æ¡å¸–å­`, 'success');
                
            } catch (error) {
                gridEl.innerHTML = `
                    <div class="content-card" style="grid-column:1/-1;background:rgba(231,76,60,0.1);border-color:#e74c3c;">
                        <h3 style="color:#e74c3c;">åŠ è½½å¤±è´¥</h3>
                        <p style="color:#ff9999;">${error.message}</p>
                        <button class="btn" onclick="loadPosts()" style="margin-top:15px;background:#e74c3c;">
                            <i class="fas fa-redo"></i> é‡è¯•
                        </button>
                    </div>
                `;
                showActivity('åŠ è½½å¸–å­å¤±è´¥: ' + error.message, 'error');
                console.error('åŠ è½½å¸–å­å¤±è´¥:', error);
            } finally {
                loadingEl.style.display = 'none';
            }
        }
        
        async function loadServers() {
            const loadingEl = document.getElementById('serversLoading');
            const gridEl = document.getElementById('serversGrid');
            
            loadingEl.style.display = 'flex';
            gridEl.innerHTML = '';
            
            try {
                const { data, error, count } = await supabase
                    .from('servers')
                    .select('*', { count: 'exact' })
                    .order('created_at', { ascending: false })
                    .limit(20);
                
                if (error) throw error;
                
                // æ›´æ–°ç»Ÿè®¡
                document.getElementById('serversCount').textContent = count || 0;
                
                if (!data || data.length === 0) {
                    gridEl.innerHTML = `
                        <div class="content-card" style="grid-column:1/-1;text-align:center;padding:50px;">
                            <i class="fas fa-server" style="font-size:3rem;color:#666;margin-bottom:20px;"></i>
                            <h3>è¿˜æ²¡æœ‰æœåŠ¡å™¨</h3>
                            <p style="color:#888;margin-top:10px;">æ·»åŠ ç¬¬ä¸€ä¸ªæœåŠ¡å™¨å§ï¼</p>
                        </div>
                    `;
                    return;
                }
                
                gridEl.innerHTML = data.map(server => `
                    <div class="content-card">
                        <div class="card-header">
                            <h3 style="margin:0;">${server.name}</h3>
                            <span class="badge ${server.platform === 'java' ? 'badge-java' : 'badge-bedrock'}">
                                ${server.platform === 'java' ? 'Javaç‰ˆ' : 'åŸºå²©ç‰ˆ'}
                            </span>
                        </div>
                        
                        <div style="background:rgba(0,0,0,0.3);padding:12px;border-radius:8px;margin:15px 0;font-family:monospace;word-break:break-all;">
                            <i class="fas fa-network-wired"></i> ${server.ip}
                        </div>
                        
                        <p style="color:#ccc;line-height:1.6;">${server.description}</p>
                        
                        <div style="margin-top:15px;padding-top:15px;border-top:1px solid rgba(255,255,255,0.1);">
                            <div style="display:flex;justify-content:space-between;align-items:center;">
                                <span style="color:#888;font-size:0.9rem;">
                                    <i class="fas fa-user"></i> ${server.author}
                                </span>
                                <button class="btn" onclick="copyIP('${server.ip}')" style="width:auto;padding:8px 15px;background:#3498db;">
                                    <i class="fas fa-copy"></i> å¤åˆ¶IP
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                showActivity(`åŠ è½½äº† ${data.length} ä¸ªæœåŠ¡å™¨`, 'success');
                
            } catch (error) {
                gridEl.innerHTML = `
                    <div class="content-card" style="grid-column:1/-1;background:rgba(231,76,60,0.1);border-color:#e74c3c;">
                        <h3 style="color:#e74c3c;">åŠ è½½å¤±è´¥</h3>
                        <p style="color:#ff9999;">${error.message}</p>
                    </div>
                `;
                showActivity('åŠ è½½æœåŠ¡å™¨å¤±è´¥: ' + error.message, 'error');
                console.error('åŠ è½½æœåŠ¡å™¨å¤±è´¥:', error);
            } finally {
                loadingEl.style.display = 'none';
            }
        }
        
        // ============ å‘å¸ƒå†…å®¹ ============
        async function submitContent() {
            const type = document.getElementById('contentType').value;
            const platform = document.querySelector('input[name="platform"]:checked').value;
            
            if (type === 'post') {
                const title = document.getElementById('postTitle').value.trim();
                const content = document.getElementById('postContent').value.trim();
                
                if (!title || !content) {
                    alert('è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹');
                    return;
                }
                
                try {
                    const { error } = await supabase
                        .from('posts')
                        .insert({
                            id: Date.now(),
                            title: title,
                            content: content,
                            platform: platform,
                            author: currentUser,
                            created_at: new Date().toISOString()
                        });
                    
                    if (error) throw error;
                    
                    // æˆåŠŸæç¤º
                    alert(`âœ… å¸–å­å‘å¸ƒæˆåŠŸï¼\n\næ ‡é¢˜: ${title}\nä½œè€…: ${currentUser}\n\næ•°æ®å·²æ°¸ä¹…å­˜å‚¨åœ¨æ‚¨çš„Supabaseæ•°æ®åº“ä¸­ï¼`);
                    
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('postTitle').value = '';
                    document.getElementById('postContent').value = '';
                    
                    // é‡æ–°åŠ è½½
                    loadPosts();
                    loadStats();
                    
                    showActivity(`${currentUser} å‘å¸ƒäº†æ–°å¸–å­: ${title}`, 'success');
                    
                } catch (error) {
                    alert('âŒ å‘å¸ƒå¤±è´¥:\n' + error.message);
                    console.error('å‘å¸ƒå¤±è´¥:', error);
                    showActivity('å‘å¸ƒå¤±è´¥: ' + error.message, 'error');
                }
                
            } else {
                const name = document.getElementById('serverName').value.trim();
                const ip = document.getElementById('serverIP').value.trim();
                const description = document.getElementById('serverDesc').value.trim();
                
                if (!name || !ip || !description) {
                    alert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
                    return;
                }
                
                try {
                    const { error } = await supabase
                        .from('servers')
                        .insert({
                            id: Date.now(),
                            name: name,
                            ip: ip,
                            description: description,
                            platform: platform,
                            author: currentUser,
                            created_at: new Date().toISOString()
                        });
                    
                    if (error) throw error;
                    
                    alert(`âœ… æœåŠ¡å™¨æ·»åŠ æˆåŠŸï¼\n\nåç§°: ${name}\nIP: ${ip}\n\nå·²ä¿å­˜åˆ°æ•°æ®åº“`);
                    
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('serverName').value = '';
                    document.getElementById('serverIP').value = '';
                    document.getElementById('serverDesc').value = '';
                    
                    // é‡æ–°åŠ è½½
                    loadServers();
                    loadStats();
                    
                    showActivity(`${currentUser} æ·»åŠ äº†æœåŠ¡å™¨: ${name}`, 'success');
                    
                } catch (error) {
                    alert('æ·»åŠ å¤±è´¥: ' + error.message);
                    console.error('æ·»åŠ å¤±è´¥:', error);
                    showActivity('æ·»åŠ æœåŠ¡å™¨å¤±è´¥: ' + error.message, 'error');
                }
            }
        }
        
        // ============ ç»Ÿè®¡å’Œæ´»åŠ¨ ============
        async function loadStats() {
            try {
                // è·å–å¸–å­æ•°é‡
                const { count: postsCount } = await supabase
                    .from('posts')
                    .select('*', { count: 'exact', head: true });
                
                // è·å–æœåŠ¡å™¨æ•°é‡
                const { count: serversCount } = await supabase
                    .from('servers')
                    .select('*', { count: 'exact', head: true });
                
                document.getElementById('postsCount').textContent = postsCount || 0;
                document.getElementById('serversCount').textContent = serversCount || 0;
                
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥:', error);
            }
        }
        
        function showActivity(message, type = 'info') {
            const feed = document.getElementById('activityFeed');
            const icon = type === 'success' ? 'fa-check-circle' : 
                        type === 'error' ? 'fa-times-circle' : 
                        type === 'warning' ? 'fa-exclamation-circle' : 'fa-info-circle';
            const color = type === 'success' ? '#3ecf8e' : 
                         type === 'error' ? '#e74c3c' : 
                         type === 'warning' ? '#f39c12' : '#3498db';
            
            const activityItem = document.createElement('div');
            activityItem.className = 'activity-item';
            activityItem.innerHTML = `
                <i class="fas ${icon}" style="color:${color};"></i>
                <span>${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} - ${message}</span>
            `;
            
            feed.insertBefore(activityItem, feed.firstChild);
            
            // ä¿æŒæœ€å¤š10æ¡è®°å½•
            if (feed.children.length > 10) {
                feed.removeChild(feed.lastChild);
            }
        }
        
        // ============ å·¥å…·å‡½æ•° ============
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'åˆšåˆš';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'åˆ†é’Ÿå‰';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'å°æ—¶å‰';
            
            return date.toLocaleDateString('zh-CN');
        }
        
        function copyIP(ip) {
            navigator.clipboard.writeText(ip).then(() => {
                alert('âœ… IPå·²å¤åˆ¶åˆ°å‰ªè´´æ¿:\n' + ip);
                showActivity('å¤åˆ¶äº†IPåœ°å€: ' + ip, 'success');
            }).catch(() => {
                const input = document.createElement('input');
                input.value = ip;
                document.body.appendChild(input);
                input.select();
                document.execCommand('copy');
                document.body.removeChild(input);
                alert('IPå·²å¤åˆ¶');
            });
        }
        
        // ============ é¡µé¢åˆå§‹åŒ– ============
        window.onload = function() {
            console.log('ğŸš€ Minecraftç¤¾åŒºå¯åŠ¨ä¸­...');
            console.log('ğŸ“Š æ•°æ®åº“:', SUPABASE_URL);
            console.log('ğŸ”‘ Keyç±»å‹:', 'anon/public (æ­£ç¡®)');
            
            // æµ‹è¯•è¿æ¥
            testConnection();
            
            // åŠ è½½æ•°æ®
            loadPosts();
            loadServers();
            
            // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
            showActivity(`æ¬¢è¿ ${currentUser}`, 'success');
            showActivity('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ', 'info');
            
            // å®šæ—¶åˆ·æ–°ç»Ÿè®¡
            setInterval(loadStats, 30000);
        };
    </script>
</body>
</html>