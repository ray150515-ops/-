<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ® Minecraftæ°¸ä¹…ç¤¾åŒº | æ‚¨çš„ä¸“å±ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --mc-green: #3b8526;
            --mc-dark: #1a2c1a;
            --mc-light: #2d4a2d;
            --java-red: #e74c3c;
            --bedrock-blue: #3498db;
        }
        
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',sans-serif; }
        body { background:var(--mc-dark); color:white; min-height:100vh; }
        .container { max-width:1000px; margin:0 auto; padding:20px; }
        
        /* å¤´éƒ¨ */
        .header {
            background: linear-gradient(135deg, #1a2c1a, #2d4a2d);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid var(--mc-green);
            text-align: center;
        }
        
        .header h1 { font-size:2.5rem; color:var(--mc-green); margin-bottom:10px; }
        .header p { color:#ccc; font-size:1.1rem; }
        
        .status-box {
            background:rgba(59,133,38,0.1);
            border:2px solid var(--mc-green);
            border-radius:10px;
            padding:15px;
            margin:20px 0;
            text-align:center;
        }
        
        .status-box.success { background:rgba(59,133,38,0.2); border-color:#3b8526; }
        .status-box.error { background:rgba(231,76,60,0.2); border-color:#e74c3c; }
        
        /* é€‰é¡¹å¡ */
        .tabs {
            display:flex;
            gap:5px;
            margin:30px 0;
            background:rgba(255,255,255,0.05);
            padding:5px;
            border-radius:10px;
        }
        
        .tab {
            flex:1;
            padding:15px;
            background:transparent;
            border:none;
            color:white;
            cursor:pointer;
            border-radius:8px;
            font-size:1rem;
        }
        
        .tab.active {
            background:var(--mc-green);
            font-weight:bold;
        }
        
        /* è¡¨å• */
        .form-box {
            background:rgba(26,44,26,0.8);
            padding:30px;
            border-radius:15px;
            border:1px solid rgba(255,255,255,0.1);
            margin-bottom:30px;
        }
        
        .form-group { margin-bottom:20px; }
        .form-control {
            width:100%;
            padding:15px;
            background:rgba(255,255,255,0.1);
            border:1px solid rgba(255,255,255,0.2);
            border-radius:8px;
            color:white;
            font-size:1rem;
        }
        
        textarea.form-control { min-height:120px; resize:vertical; }
        
        /* æŒ‰é’® */
        .btn {
            padding:15px 30px;
            background:var(--mc-green);
            color:white;
            border:none;
            border-radius:8px;
            cursor:pointer;
            font-size:1.1rem;
            font-weight:bold;
            transition:0.3s;
            width:100%;
        }
        
        .btn:hover {
            background:#5ba34e;
            transform:translateY(-2px);
            box-shadow:0 5px 15px rgba(59,133,38,0.4);
        }
        
        /* å†…å®¹å¡ç‰‡ */
        .grid {
            display:grid;
            grid-template-columns:repeat(auto-fill, minmax(350px, 1fr));
            gap:20px;
            margin:30px 0;
        }
        
        .card {
            background:rgba(255,255,255,0.05);
            padding:25px;
            border-radius:12px;
            border:1px solid rgba(255,255,255,0.1);
            transition:0.3s;
        }
        
        .card:hover {
            transform:translateY(-5px);
            border-color:var(--mc-green);
            box-shadow:0 10px 25px rgba(0,0,0,0.3);
        }
        
        .badge {
            padding:5px 12px;
            border-radius:20px;
            font-size:0.9rem;
            font-weight:bold;
        }
        
        .badge-java { background:rgba(231,76,60,0.2); color:var(--java-red); }
        .badge-bedrock { background:rgba(52,152,219,0.2); color:var(--bedrock-blue); }
        
        /* åŠ è½½åŠ¨ç”» */
        .loader {
            display:flex;
            justify-content:center;
            gap:10px;
            margin:40px 0;
        }
        
        .loader div {
            width:20px;
            height:20px;
            background:var(--mc-green);
            border-radius:50%;
            animation:bounce 1.4s infinite both;
        }
        
        @keyframes bounce {
            0%, 80%, 100% { transform:scale(0); }
            40% { transform:scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1><i class="fas fa-cube"></i> Minecraftæ°¸ä¹…ç¤¾åŒº</h1>
            <p>æ‚¨çš„ä¸“å±æ•°æ®åº“ï¼šisvyleujyxrjxvqrutrm.supabase.co</p>
            <div class="status-box" id="status">
                <div class="loader" style="display:flex;justify-content:center;gap:5px;">
                    <div></div><div></div><div></div>
                </div>
                <div>æ­£åœ¨è¿æ¥æ‚¨çš„Supabaseæ•°æ®åº“...</div>
            </div>
        </div>
        
        <!-- é€‰é¡¹å¡ -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('posts')">ğŸ“ å¸–å­</button>
            <button class="tab" onclick="switchTab('servers')">ğŸ–¥ï¸ æœåŠ¡å™¨</button>
            <button class="tab" onclick="switchTab('create')">â• å‘å¸ƒ</button>
        </div>
        
        <!-- å¸–å­åŒº -->
        <div id="postsArea">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                <h2>æœ€æ–°å¸–å­</h2>
                <button class="btn" onclick="loadPosts()" style="width:auto;padding:10px 20px;">åˆ·æ–°</button>
            </div>
            <div id="postsGrid" class="grid">
                <div class="card">åŠ è½½ä¸­...</div>
            </div>
        </div>
        
        <!-- æœåŠ¡å™¨åŒº -->
        <div id="serversArea" style="display:none;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                <h2>æœåŠ¡å™¨åˆ—è¡¨</h2>
                <button class="btn" onclick="loadServers()" style="width:auto;padding:10px 20px;">åˆ·æ–°</button>
            </div>
            <div id="serversGrid" class="grid">
                <div class="card">åŠ è½½ä¸­...</div>
            </div>
        </div>
        
        <!-- å‘å¸ƒåŒº -->
        <div id="createArea" style="display:none;">
            <div class="form-box">
                <h2 style="text-align:center;margin-bottom:25px;">å‘å¸ƒæ–°å†…å®¹</h2>
                
                <div class="form-group">
                    <select id="contentType" class="form-control" onchange="toggleForm()">
                        <option value="post">å‘å¸ƒå¸–å­</option>
                        <option value="server">æ·»åŠ æœåŠ¡å™¨</option>
                    </select>
                </div>
                
                <!-- å¸–å­è¡¨å• -->
                <div id="postForm">
                    <div class="form-group">
                        <input type="text" id="postTitle" class="form-control" placeholder="å¸–å­æ ‡é¢˜">
                    </div>
                    <div class="form-group">
                        <textarea id="postContent" class="form-control" placeholder="è¯¦ç»†å†…å®¹..."></textarea>
                    </div>
                </div>
                
                <!-- æœåŠ¡å™¨è¡¨å• -->
                <div id="serverForm" style="display:none;">
                    <div class="form-group">
                        <input type="text" id="serverName" class="form-control" placeholder="æœåŠ¡å™¨åç§°">
                    </div>
                    <div class="form-group">
                        <input type="text" id="serverIP" class="form-control" placeholder="IPåœ°å€:ç«¯å£">
                    </div>
                    <div class="form-group">
                        <textarea id="serverDesc" class="form-control" placeholder="æœåŠ¡å™¨æè¿°..."></textarea>
                    </div>
                </div>
                
                <div class="form-group">
                    <label style="display:block;margin-bottom:10px;">æ¸¸æˆç‰ˆæœ¬ï¼š</label>
                    <div style="display:flex;gap:20px;">
                        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                            <input type="radio" name="platform" value="java" checked>
                            <span class="badge badge-java">Javaç‰ˆ</span>
                        </label>
                        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                            <input type="radio" name="platform" value="bedrock">
                            <span class="badge badge-bedrock">åŸºå²©ç‰ˆ</span>
                        </label>
                    </div>
                </div>
                
                <button class="btn" onclick="submitContent()">
                    <i class="fas fa-paper-plane"></i> å‘å¸ƒåˆ°æ•°æ®åº“
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============ æ‚¨çš„é…ç½® ============
        const SUPABASE_URL = 'https://isvyleujyxrjxvqrutrm.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_Xel1Xj3NTv1W2VIz77ZE4A_XqKT9wQB';
        
        console.log('ä½¿ç”¨æ‚¨çš„Supabaseæ•°æ®åº“:', SUPABASE_URL);
        
        // åˆå§‹åŒ–Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        let currentUser = 'ç©å®¶_' + Math.floor(Math.random() * 10000);
        
        // ============ é¡µé¢å‡½æ•° ============
        function switchTab(tabName) {
            // æ›´æ–°é€‰é¡¹å¡
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // æ˜¾ç¤ºå¯¹åº”åŒºåŸŸ
            document.getElementById('postsArea').style.display = tabName === 'posts' ? 'block' : 'none';
            document.getElementById('serversArea').style.display = tabName === 'servers' ? 'block' : 'none';
            document.getElementById('createArea').style.display = tabName === 'create' ? 'block' : 'none';
            
            // åŠ è½½æ•°æ®
            if (tabName === 'posts') loadPosts();
            if (tabName === 'servers') loadServers();
        }
        
        function toggleForm() {
            const type = document.getElementById('contentType').value;
            document.getElementById('postForm').style.display = type === 'post' ? 'block' : 'none';
            document.getElementById('serverForm').style.display = type === 'server' ? 'block' : 'none';
        }
        
        // ============ æµ‹è¯•è¿æ¥ ============
        async function testConnection() {
            try {
                const statusEl = document.getElementById('status');
                statusEl.innerHTML = `
                    <div class="loader" style="display:flex;justify-content:center;gap:5px;margin-bottom:10px;">
                        <div></div><div></div><div></div>
                    </div>
                    <div>æ­£åœ¨æµ‹è¯•æ•°æ®åº“è¿æ¥...</div>
                `;
                statusEl.className = 'status-box';
                
                // æµ‹è¯•è¿æ¥
                const { data, error } = await supabase
                    .from('posts')
                    .select('count', { count: 'exact', head: true });
                
                if (error) {
                    // å¦‚æœpostsè¡¨ä¸å­˜åœ¨ï¼Œå°è¯•åˆ›å»º
                    if (error.code === '42P01') {
                        statusEl.innerHTML = 'âš ï¸ postsè¡¨ä¸å­˜åœ¨ï¼Œæ­£åœ¨æ£€æŸ¥æ•°æ®åº“...';
                        await checkAndCreateTables();
                        return;
                    }
                    throw error;
                }
                
                statusEl.innerHTML = `
                    <div style="font-size:2rem;margin-bottom:10px;">âœ…</div>
                    <div style="font-weight:bold;margin-bottom:5px;">è¿æ¥æˆåŠŸï¼</div>
                    <div style="color:#ccc;font-size:0.9rem;">
                        æ‚¨çš„Supabaseæ•°æ®åº“å·²å°±ç»ª<br>
                        URL: ${SUPABASE_URL.substring(8, 25)}...
                    </div>
                `;
                statusEl.className = 'status-box success';
                
                console.log('âœ… Supabaseè¿æ¥æˆåŠŸ');
                
            } catch (error) {
                const statusEl = document.getElementById('status');
                statusEl.innerHTML = `
                    <div style="font-size:2rem;margin-bottom:10px;">âŒ</div>
                    <div style="font-weight:bold;margin-bottom:10px;">è¿æ¥å¤±è´¥</div>
                    <div style="color:#ff9999;font-size:0.9rem;margin-bottom:10px;">
                        ${error.message}
                    </div>
                    <div style="font-size:0.8rem;color:#888;">
                        è¯·æ£€æŸ¥ï¼š<br>
                        1. API Keyæ˜¯å¦æ­£ç¡®<br>
                        2. ç½‘ç»œè¿æ¥<br>
                        3. Supabaseé¡¹ç›®çŠ¶æ€
                    </div>
                `;
                statusEl.className = 'status-box error';
                console.error('âŒ Supabaseè¿æ¥å¤±è´¥:', error);
            }
        }
        
        // ============ æ£€æŸ¥å¹¶åˆ›å»ºè¡¨ ============
        async function checkAndCreateTables() {
            try {
                const statusEl = document.getElementById('status');
                statusEl.innerHTML = 'æ­£åœ¨æ£€æŸ¥æ•°æ®åº“è¡¨ç»“æ„...';
                
                // è¿™é‡Œæˆ‘ä»¬å‡è®¾è¡¨å·²åˆ›å»ºï¼ˆæ‚¨å·²ç»æ‰§è¡Œäº†SQLï¼‰
                // å¦‚æœè¿˜éœ€è¦åˆ›å»ºï¼Œå¯ä»¥é€šè¿‡REST APIæˆ–SQLç¼–è¾‘å™¨
                
                statusEl.innerHTML = `
                    <div style="font-size:2rem;margin-bottom:10px;">âœ…</div>
                    <div style="font-weight:bold;margin-bottom:5px;">æ•°æ®åº“å°±ç»ª</div>
                    <div style="color:#ccc;font-size:0.9rem;">
                        è¡¨ç»“æ„æ£€æŸ¥å®Œæˆ<br>
                        å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼
                    </div>
                `;
                statusEl.className = 'status-box success';
                
            } catch (error) {
                console.error('åˆ›å»ºè¡¨å¤±è´¥:', error);
            }
        }
        
        // ============ åŠ è½½å¸–å­ ============
        async function loadPosts() {
            const gridEl = document.getElementById('postsGrid');
            gridEl.innerHTML = `
                <div class="card" style="text-align:center;padding:40px;">
                    <div class="loader" style="margin-bottom:20px;">
                        <div></div><div></div><div></div>
                    </div>
                    <div>æ­£åœ¨åŠ è½½å¸–å­...</div>
                </div>
            `;
            
            try {
                const { data, error } = await supabase
                    .from('posts')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(20);
                
                if (error) throw error;
                
                if (!data || data.length === 0) {
                    gridEl.innerHTML = `
                        <div class="card" style="grid-column:1/-1;text-align:center;padding:50px;">
                            <div style="font-size:3rem;color:#666;margin-bottom:20px;">ğŸ“</div>
                            <h3>è¿˜æ²¡æœ‰å¸–å­</h3>
                            <p style="color:#888;margin-top:10px;">å‘å¸ƒç¬¬ä¸€ä¸ªå¸–å­å§ï¼</p>
                        </div>
                    `;
                    return;
                }
                
                gridEl.innerHTML = data.map(post => `
                    <div class="card">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
                            <div style="font-weight:bold;color:#3b8526;">${post.author || 'åŒ¿å'}</div>
                            <span class="badge ${post.platform === 'java' ? 'badge-java' : 'badge-bedrock'}">
                                ${post.platform === 'java' ? 'Javaç‰ˆ' : 'åŸºå²©ç‰ˆ'}
                            </span>
                        </div>
                        <h3 style="margin-bottom:10px;">${post.title}</h3>
                        <p style="color:#ccc;line-height:1.6;margin-bottom:15px;">${post.content}</p>
                        <div style="display:flex;justify-content:space-between;color:#888;font-size:0.9rem;">
                            <span>${formatDate(post.created_at)}</span>
                            <span>#${post.id}</span>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                gridEl.innerHTML = `
                    <div class="card" style="grid-column:1/-1;background:rgba(231,76,60,0.1);border-color:#e74c3c;">
                        <h3 style="color:#e74c3c;">åŠ è½½å¤±è´¥</h3>
                        <p style="color:#ff9999;">${error.message}</p>
                        <button class="btn" onclick="loadPosts()" style="margin-top:15px;background:#e74c3c;">
                            é‡è¯•
                        </button>
                    </div>
                `;
                console.error('åŠ è½½å¸–å­å¤±è´¥:', error);
            }
        }
        
        // ============ åŠ è½½æœåŠ¡å™¨ ============
        async function loadServers() {
            const gridEl = document.getElementById('serversGrid');
            gridEl.innerHTML = `
                <div class="card" style="text-align:center;padding:40px;">
                    <div class="loader" style="margin-bottom:20px;">
                        <div></div><div></div><div></div>
                    </div>
                    <div>æ­£åœ¨åŠ è½½æœåŠ¡å™¨...</div>
                </div>
            `;
            
            try {
                const { data, error } = await supabase
                    .from('servers')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(20);
                
                if (error) throw error;
                
                if (!data || data.length === 0) {
                    gridEl.innerHTML = `
                        <div class="card" style="grid-column:1/-1;text-align:center;padding:50px;">
                            <div style="font-size:3rem;color:#666;margin-bottom:20px;">ğŸ–¥ï¸</div>
                            <h3>è¿˜æ²¡æœ‰æœåŠ¡å™¨</h3>
                            <p style="color:#888;margin-top:10px;">æ·»åŠ ç¬¬ä¸€ä¸ªæœåŠ¡å™¨å§ï¼</p>
                        </div>
                    `;
                    return;
                }
                
                gridEl.innerHTML = data.map(server => `
                    <div class="card">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
                            <h3 style="margin:0;">${server.name}</h3>
                            <span class="badge ${server.platform === 'java' ? 'badge-java' : 'badge-bedrock'}">
                                ${server.platform === 'java' ? 'Javaç‰ˆ' : 'åŸºå²©ç‰ˆ'}
                            </span>
                        </div>
                        
                        <div style="background:rgba(0,0,0,0.3);padding:12px;border-radius:6px;margin:15px 0;font-family:monospace;">
                            ${server.ip}
                        </div>
                        
                        <p style="color:#ccc;line-height:1.6;margin-bottom:15px;">${server.description}</p>
                        
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <span style="color:#888;font-size:0.9rem;">${server.author}</span>
                            <button class="btn" onclick="copyIP('${server.ip}')" style="width:auto;padding:8px 15px;font-size:0.9rem;">
                                å¤åˆ¶IP
                            </button>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                gridEl.innerHTML = `
                    <div class="card" style="grid-column:1/-1;background:rgba(231,76,60,0.1);border-color:#e74c3c;">
                        <h3 style="color:#e74c3c;">åŠ è½½å¤±è´¥</h3>
                        <p style="color:#ff9999;">${error.message}</p>
                    </div>
                `;
                console.error('åŠ è½½æœåŠ¡å™¨å¤±è´¥:', error);
            }
        }
        
        // ============ å‘å¸ƒå†…å®¹ ============
        async function submitContent() {
            const type = document.getElementById('contentType').value;
            const platform = document.querySelector('input[name="platform"]:checked').value;
            
            if (type === 'post') {
                const title = document.getElementById('postTitle').value.trim();
                const content = document.getElementById('postContent').value.trim();
                
                if (!title || !content) {
                    alert('è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹');
                    return;
                }
                
                try {
                    const { error } = await supabase
                        .from('posts')
                        .insert({
                            id: Date.now(),
                            title: title,
                            content: content,
                            platform: platform,
                            author: currentUser,
                            created_at: new Date().toISOString()
                        });
                    
                    if (error) throw error;
                    
                    alert('âœ… å¸–å­å‘å¸ƒæˆåŠŸï¼\næ•°æ®å·²ä¿å­˜åˆ°æ‚¨çš„Supabaseæ•°æ®åº“ï¼Œæ‰€æœ‰äººéƒ½èƒ½çœ‹åˆ°ï¼');
                    
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('postTitle').value = '';
                    document.getElementById('postContent').value = '';
                    
                    // åˆ·æ–°å¸–å­åˆ—è¡¨
                    loadPosts();
                    switchTab('posts');
                    
                } catch (error) {
                    alert('å‘å¸ƒå¤±è´¥: ' + error.message);
                    console.error('å‘å¸ƒå¤±è´¥:', error);
                }
                
            } else {
                const name = document.getElementById('serverName').value.trim();
                const ip = document.getElementById('serverIP').value.trim();
                const description = document.getElementById('serverDesc').value.trim();
                
                if (!name || !ip || !description) {
                    alert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
                    return;
                }
                
                try {
                    const { error } = await supabase
                        .from('servers')
                        .insert({
                            id: Date.now(),
                            name: name,
                            ip: ip,
                            description: description,
                            platform: platform,
                            author: currentUser,
                            created_at: new Date().toISOString()
                        });
                    
                    if (error) throw error;
                    
                    alert('âœ… æœåŠ¡å™¨æ·»åŠ æˆåŠŸï¼');
                    
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('serverName').value = '';
                    document.getElementById('serverIP').value = '';
                    document.getElementById('serverDesc').value = '';
                    
                    // åˆ·æ–°æœåŠ¡å™¨åˆ—è¡¨
                    loadServers();
                    switchTab('servers');
                    
                } catch (error) {
                    alert('æ·»åŠ å¤±è´¥: ' + error.message);
                    console.error('æ·»åŠ å¤±è´¥:', error);
                }
            }
        }
        
        // ============ å·¥å…·å‡½æ•° ============
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'åˆšåˆš';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'åˆ†é’Ÿå‰';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'å°æ—¶å‰';
            
            return date.toLocaleDateString('zh-CN') + ' ' + 
                   date.toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'});
        }
        
        function copyIP(ip) {
            navigator.clipboard.writeText(ip).then(() => {
                alert('IPå·²å¤åˆ¶åˆ°å‰ªè´´æ¿: ' + ip);
            });
        }
        
        // ============ é¡µé¢åˆå§‹åŒ– ============
        window.onload = function() {
            // æ·»åŠ Font Awesomeå›¾æ ‡
            const fa = document.createElement('link');
            fa.rel = 'stylesheet';
            fa.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css';
            document.head.appendChild(fa);
            
            // æµ‹è¯•è¿æ¥
            testConnection();
            
            // åŠ è½½å¸–å­
            loadPosts();
            
            // æ˜¾ç¤ºç”¨æˆ·å
            document.getElementById('status').innerHTML += 
                `<div style="margin-top:10px;color:#ccc;">å½“å‰ç”¨æˆ·: ${currentUser}</div>`;
        };
    </script>
</body>
</html>