<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ® Minecraftæ°¸ä¹…ç¤¾åŒº | å®Œæ•´åŠŸèƒ½ç‰ˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ====== å®Œæ•´CSSæ ·å¼ ====== */
        :root {
            --mc-green: #3b8526;
            --mc-dark: #1a2c1a;
            --mc-light: #2d4a2d;
            --java-red: #e74c3c;
            --bedrock-blue: #3498db;
            --text-white: #ffffff;
            --text-gray: #cccccc;
            --card-bg: rgba(255, 255, 255, 0.05);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        
        body {
            background: linear-gradient(135deg, var(--mc-dark) 0%, #0f1a0f 100%);
            color: var(--text-white);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        
        /* å¤´éƒ¨ */
        header {
            background: rgba(26, 44, 26, 0.95);
            padding: 20px 0;
            border-bottom: 3px solid var(--mc-green);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i { color: var(--mc-green); font-size: 2rem; }
        .logo h1 { font-size: 1.8rem; background: linear-gradient(45deg, #3b8526, #5ba34e); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* æŒ‰é’® */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }
        
        .btn-primary { background: var(--mc-green); color: white; }
        .btn-primary:hover { background: #5ba34e; transform: translateY(-2px); }
        .btn-secondary { background: transparent; border: 2px solid var(--mc-green); color: white; }
        .btn-small { padding: 6px 12px; font-size: 0.9rem; }
        
        /* é€‰é¡¹å¡ */
        .tabs {
            display: flex;
            gap: 5px;
            margin: 30px 0;
            background: rgba(255, 255, 255, 0.05);
            padding: 5px;
            border-radius: 10px;
        }
        
        .tab {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            color: var(--text-white);
            cursor: pointer;
            border-radius: 6px;
            text-align: center;
        }
        
        .tab.active { background: var(--mc-green); }
        
        /* å†…å®¹åŒº */
        .content-area {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .content-area.active { display: block; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* è¡¨å• */
        .form-container {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .form-group { margin-bottom: 20px; }
        .form-control {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: white;
            font-size: 1rem;
        }
        
        textarea.form-control { min-height: 100px; resize: vertical; }
        
        /* å¡ç‰‡ */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            border-color: var(--mc-green);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .badge {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .badge-java { background: rgba(231, 76, 60, 0.2); color: var(--java-red); }
        .badge-bedrock { background: rgba(52, 152, 219, 0.2); color: var(--bedrock-blue); }
        
        /* ç”¨æˆ· */
        .user-info { display: flex; align-items: center; gap: 10px; }
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--mc-green);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: var(--mc-dark);
            padding: 30px;
            border-radius: 10px;
            max-width: 400px;
            width: 90%;
            border: 2px solid var(--mc-green);
        }
        
        .close-modal {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        /* æç¤º */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--mc-green);
            color: white;
            padding: 15px 25px;
            border-radius: 5px;
            display: none;
            z-index: 1001;
        }
        
        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .header-content { flex-direction: column; gap: 15px; }
            .grid { grid-template-columns: 1fr; }
            .tabs { flex-direction: column; }
        }
    </style>
</head>
<body>
    <!-- åŠ è½½ç•Œé¢ -->
    <div id="loading" style="position:fixed;top:0;left:0;width:100%;height:100%;background:var(--mc-dark);display:flex;justify-content:center;align-items:center;z-index:9999;">
        <div style="text-align:center;">
            <div style="display:flex;gap:10px;margin-bottom:20px;justify-content:center;">
                <div style="width:20px;height:20px;background:var(--mc-green);border-radius:50%;animation:bounce 1.4s infinite;"></div>
                <div style="width:20px;height:20px;background:var(--mc-green);border-radius:50%;animation:bounce 1.4s infinite 0.2s;"></div>
                <div style="width:20px;height:20px;background:var(--mc-green);border-radius:50%;animation:bounce 1.4s infinite 0.4s;"></div>
            </div>
            <p>åŠ è½½ Minecraft ç¤¾åŒºå¹³å°...</p>
        </div>
    </div>

    <!-- ä¸»åº”ç”¨ -->
    <div id="app" style="display:none;">
        <header>
            <div class="container header-content">
                <div class="logo">
                    <i class="fas fa-cube"></i>
                    <h1>Minecraftæ°¸ä¹…ç¤¾åŒº</h1>
                </div>
                <div class="user-actions">
                    <div class="user-info" id="userInfo">
                        <div class="avatar" id="userAvatar">?</div>
                        <span id="userName">æ¸¸å®¢</span>
                    </div>
                    <button class="btn btn-primary" id="loginBtn">
                        <i class="fas fa-user"></i>ç™»å½•
                    </button>
                </div>
            </div>
        </header>

        <main class="container">
            <!-- ç»Ÿè®¡ä¿¡æ¯ -->
            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:20px;margin:30px 0;">
                <div style="background:var(--card-bg);padding:20px;border-radius:10px;text-align:center;">
                    <i class="fas fa-comments" style="color:var(--mc-green);font-size:2rem;margin-bottom:10px;"></i>
                    <h3 id="postsCount">0</h3>
                    <p>æ€»å¸–å­</p>
                </div>
                <div style="background:var(--card-bg);padding:20px;border-radius:10px;text-align:center;">
                    <i class="fas fa-server" style="color:var(--mc-green);font-size:2rem;margin-bottom:10px;"></i>
                    <h3 id="serversCount">0</h3>
                    <p>æœåŠ¡å™¨</p>
                </div>
                <div style="background:var(--card-bg);padding:20px;border-radius:10px;text-align:center;">
                    <i class="fas fa-users" style="color:var(--mc-green);font-size:2rem;margin-bottom:10px;"></i>
                    <h3 id="usersCount">0</h3>
                    <p>åœ¨çº¿ç©å®¶</p>
                </div>
                <div style="background:var(--card-bg);padding:20px;border-radius:10px;text-align:center;">
                    <i class="fas fa-cloud" style="color:var(--mc-green);font-size:2rem;margin-bottom:10px;"></i>
                    <h3>æ°¸ä¹…</h3>
                    <p>æ•°æ®å­˜å‚¨</p>
                </div>
            </div>

            <!-- é€‰é¡¹å¡ -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('posts')">
                    <i class="fas fa-comments"></i> ç©å®¶å¸–å­
                </button>
                <button class="tab" onclick="switchTab('servers')">
                    <i class="fas fa-server"></i> æœåŠ¡å™¨åˆ—è¡¨
                </button>
                <button class="tab" onclick="switchTab('create')">
                    <i class="fas fa-plus"></i> å‘å¸ƒå†…å®¹
                </button>
            </div>

            <!-- å¸–å­åŒº -->
            <div id="postsArea" class="content-area active">
                <h2 style="margin-bottom:20px;"><i class="fas fa-comments"></i> ç©å®¶å¸–å­</h2>
                <div class="grid" id="postsGrid">
                    <!-- å¸–å­åŠ¨æ€åŠ è½½ -->
                </div>
            </div>

            <!-- æœåŠ¡å™¨åŒº -->
            <div id="serversArea" class="content-area">
                <h2 style="margin-bottom:20px;"><i class="fas fa-server"></i> æœåŠ¡å™¨åˆ—è¡¨</h2>
                <div class="grid" id="serversGrid">
                    <!-- æœåŠ¡å™¨åŠ¨æ€åŠ è½½ -->
                </div>
            </div>

            <!-- å‘å¸ƒåŒº -->
            <div id="createArea" class="content-area">
                <div class="form-container">
                    <h2 style="margin-bottom:20px;"><i class="fas fa-plus-circle"></i> å‘å¸ƒå†…å®¹</h2>
                    
                    <div class="form-group">
                        <select id="contentType" class="form-control" onchange="toggleForm()">
                            <option value="post">å‘å¸ƒå¸–å­</option>
                            <option value="server">æ·»åŠ æœåŠ¡å™¨</option>
                        </select>
                    </div>

                    <!-- å¸–å­è¡¨å• -->
                    <div id="postForm">
                        <div class="form-group">
                            <input type="text" id="postTitle" class="form-control" placeholder="å¸–å­æ ‡é¢˜">
                        </div>
                        <div class="form-group">
                            <textarea id="postContent" class="form-control" placeholder="å¸–å­å†…å®¹..."></textarea>
                        </div>
                    </div>

                    <!-- æœåŠ¡å™¨è¡¨å• -->
                    <div id="serverForm" style="display:none;">
                        <div class="form-group">
                            <input type="text" id="serverName" class="form-control" placeholder="æœåŠ¡å™¨åç§°">
                        </div>
                        <div class="form-group">
                            <input type="text" id="serverIP" class="form-control" placeholder="IPåœ°å€:ç«¯å£">
                        </div>
                        <div class="form-group">
                            <textarea id="serverDesc" class="form-control" placeholder="æœåŠ¡å™¨æè¿°..."></textarea>
                        </div>
                    </div>

                    <div class="form-group">
                        <label style="display:block;margin-bottom:10px;">æ¸¸æˆç‰ˆæœ¬ï¼š</label>
                        <div style="display:flex;gap:15px;">
                            <label style="display:flex;align-items:center;gap:5px;">
                                <input type="radio" name="platform" value="java" checked>
                                <span class="badge badge-java">Javaç‰ˆ</span>
                            </label>
                            <label style="display:flex;align-items:center;gap:5px;">
                                <input type="radio" name="platform" value="bedrock">
                                <span class="badge badge-bedrock">åŸºå²©ç‰ˆ</span>
                            </label>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="submitContent()" style="width:100%;">
                        <i class="fas fa-paper-plane"></i> å‘å¸ƒ
                    </button>
                </div>
            </div>
        </main>

        <!-- ç™»å½•æ¨¡æ€æ¡† -->
        <div class="modal" id="loginModal">
            <div class="modal-content">
                <span class="close-modal" onclick="closeModal()">&times;</span>
                <h2 style="margin-bottom:20px;"><i class="fas fa-user-circle"></i> ç”¨æˆ·ç™»å½•</h2>
                
                <div class="form-group">
                    <input type="text" id="username" class="form-control" placeholder="ç”¨æˆ·å">
                </div>
                <div class="form-group">
                    <input type="password" id="password" class="form-control" placeholder="å¯†ç ">
                </div>
                
                <button class="btn btn-primary" onclick="userLogin()" style="width:100%;margin-bottom:10px;">
                    <i class="fas fa-sign-in-alt"></i> ç™»å½•
                </button>
                
                <button class="btn btn-secondary" onclick="userRegister()" style="width:100%;">
                    <i class="fas fa-user-plus"></i> æ³¨å†Œæ–°è´¦å·
                </button>
                
                <p style="margin-top:20px;text-align:center;color:#888;font-size:0.9rem;">
                    æ•°æ®æ°¸ä¹…å­˜å‚¨åœ¨Cloudflare KVä¸­
                </p>
            </div>
        </div>

        <!-- æç¤ºä¿¡æ¯ -->
        <div class="toast" id="toast"></div>
    </div>

    <!-- ====== å®Œæ•´çš„JavaScriptä»£ç  ====== -->
    <script>
        // é…ç½®
        const API_BASE = '/api';
        let currentUser = null;
        let posts = [];
        let servers = [];

        // é¡µé¢åŠ è½½
        window.onload = function() {
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                initApp();
            }, 1000);
        };

        // åˆå§‹åŒ–
        function initApp() {
            // ç»‘å®šäº‹ä»¶
            document.getElementById('loginBtn').onclick = openLoginModal;
            
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            checkAuth();
            
            // åŠ è½½æ•°æ®
            loadData();
        }

        // åˆ‡æ¢é€‰é¡¹å¡
        function switchTab(tabName) {
            // æ›´æ–°é€‰é¡¹å¡æ ·å¼
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`.tab[onclick*="${tabName}"]`).classList.add('active');
            
            // æ˜¾ç¤ºå¯¹åº”åŒºåŸŸ
            document.querySelectorAll('.content-area').forEach(area => {
                area.classList.remove('active');
            });
            document.getElementById(tabName + 'Area').classList.add('active');
        }

        // åˆ‡æ¢è¡¨å•ç±»å‹
        function toggleForm() {
            const type = document.getElementById('contentType').value;
            document.getElementById('postForm').style.display = type === 'post' ? 'block' : 'none';
            document.getElementById('serverForm').style.display = type === 'server' ? 'block' : 'none';
        }

        // æ£€æŸ¥è®¤è¯çŠ¶æ€
        function checkAuth() {
            const userData = localStorage.getItem('mc_user');
            if (userData) {
                try {
                    currentUser = JSON.parse(userData);
                    updateUserUI();
                } catch (e) {
                    console.error('è§£æç”¨æˆ·æ•°æ®å¤±è´¥');
                }
            }
        }

        // æ›´æ–°ç”¨æˆ·ç•Œé¢
        function updateUserUI() {
            const userInfo = document.getElementById('userInfo');
            const loginBtn = document.getElementById('loginBtn');
            
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.username;
                document.getElementById('userAvatar').textContent = currentUser.username.charAt(0).toUpperCase();
                loginBtn.innerHTML = '<i class="fas fa-sign-out-alt"></i>é€€å‡º';
                loginBtn.onclick = logout;
            } else {
                document.getElementById('userName').textContent = 'æ¸¸å®¢';
                document.getElementById('userAvatar').textContent = '?';
                loginBtn.innerHTML = '<i class="fas fa-user"></i>ç™»å½•';
                loginBtn.onclick = openLoginModal;
            }
        }

        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                // åŠ è½½å¸–å­
                const postsRes = await fetch(API_BASE + '/posts');
                if (postsRes.ok) {
                    posts = await postsRes.json();
                    renderPosts();
                }
                
                // åŠ è½½æœåŠ¡å™¨
                const serversRes = await fetch(API_BASE + '/servers');
                if (serversRes.ok) {
                    servers = await serversRes.json();
                    renderServers();
                }
                
                // åŠ è½½ç»Ÿè®¡
                const statsRes = await fetch(API_BASE + '/stats');
                if (statsRes.ok) {
                    const stats = await statsRes.json();
                    updateStats(stats);
                }
                
            } catch (error) {
                console.log('ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®');
                loadMockData();
            }
        }

        // åŠ è½½æ¨¡æ‹Ÿæ•°æ®
        function loadMockData() {
            // æ¨¡æ‹Ÿå¸–å­
            posts = [
                {
                    id: 1,
                    title: 'æ¬¢è¿æ¥åˆ°Minecraftç¤¾åŒºï¼',
                    content: 'è¿™æ˜¯ä¸€ä¸ªåŸºäºCloudflare Pagesæ„å»ºçš„æ°¸ä¹…ç¤¾åŒºå¹³å°ï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¼šæ°¸ä¹…ä¿å­˜ã€‚',
                    author: 'ç®¡ç†å‘˜',
                    platform: 'java',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    title: 'çº¢çŸ³æ•™ç¨‹ï¼šè‡ªåŠ¨å†œåœº',
                    content: 'ä»Šå¤©åˆ†äº«ä¸€ä¸ªé«˜æ•ˆçš„çº¢çŸ³è‡ªåŠ¨å†œåœºè®¾è®¡ï¼Œé€‚ç”¨äºJavaç‰ˆ1.20+',
                    author: 'çº¢çŸ³å¤§å¸ˆ',
                    platform: 'java',
                    createdAt: new Date(Date.now() - 3600000).toISOString()
                },
                {
                    id: 3,
                    title: 'åŸºå²©ç‰ˆè·¨å¹³å°è”æœº',
                    content: 'æ•™å¤§å®¶å¦‚ä½•åœ¨æ‰‹æœºã€PCå’Œä¸»æœºä¹‹é—´è¿›è¡ŒåŸºå²©ç‰ˆè”æœº',
                    author: 'è”æœºåŠ©æ‰‹',
                    platform: 'bedrock',
                    createdAt: new Date(Date.now() - 7200000).toISOString()
                }
            ];
            
            // æ¨¡æ‹ŸæœåŠ¡å™¨
            servers = [
                {
                    id: 1,
                    name: 'æ¢¦æƒ³ä¹‹åŸç”Ÿå­˜æœ',
                    ip: 'play.dreamcitymc.com:25565',
                    description: 'å¤§å‹ç”Ÿå­˜æœåŠ¡å™¨ï¼Œæ‹¥æœ‰ç»æµç³»ç»Ÿã€é¢†åœ°ä¿æŠ¤å’Œä¸°å¯Œçš„ç¤¾åŒºæ´»åŠ¨',
                    author: 'DreamAdmin',
                    platform: 'java',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    name: 'åŸºå²©å°æ¸¸æˆä¹å›­',
                    ip: 'bedrock.gameserver.top:19132',
                    description: 'ä¸“ä¸ºåŸºå²©ç‰ˆç©å®¶æ‰“é€ çš„å°æ¸¸æˆæœåŠ¡å™¨ï¼ŒåŒ…å«èµ·åºŠæˆ˜äº‰ã€ç©ºå²›æˆ˜äº‰ç­‰',
                    author: 'GameMaster',
                    platform: 'bedrock',
                    createdAt: new Date(Date.now() - 86400000).toISOString()
                },
                {
                    id: 3,
                    name: 'çº¢çŸ³åˆ›é€ æœ',
                    ip: 'redstone.creative.net:25565',
                    description: 'ä¸“æ³¨äºçº¢çŸ³ç”µè·¯å’Œåˆ›é€ å»ºç­‘çš„æœåŠ¡å™¨ï¼Œæä¾›ä¸°å¯Œèµ„æº',
                    author: 'RedstonePro',
                    platform: 'java',
                    createdAt: new Date(Date.now() - 172800000).toISOString()
                }
            ];
            
            renderPosts();
            renderServers();
            updateStats({
                posts: posts.length,
                servers: servers.length,
                users: 15
            });
        }

        // æ¸²æŸ“å¸–å­
        function renderPosts() {
            const container = document.getElementById('postsGrid');
            if (!container) return;
            
            if (posts.length === 0) {
                container.innerHTML = `
                    <div style="grid-column:1/-1;text-align:center;padding:40px;">
                        <i class="fas fa-inbox" style="font-size:3rem;color:#666;margin-bottom:15px;"></i>
                        <p>è¿˜æ²¡æœ‰å¸–å­ï¼Œå‘å¸ƒç¬¬ä¸€ä¸ªå§ï¼</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = posts.map(post => `
                <div class="card">
                    <div class="card-header">
                        <strong>${post.author}</strong>
                        <span class="badge ${post.platform === 'java' ? 'badge-java' : 'badge-bedrock'}">
                            ${post.platform === 'java' ? 'Javaç‰ˆ' : 'åŸºå²©ç‰ˆ'}
                        </span>
                    </div>
                    <h3 style="margin-bottom:10px;">${post.title}</h3>
                    <p style="color:#ccc;margin-bottom:15px;">${post.content}</p>
                    <div style="display:flex;justify-content:space-between;color:#888;font-size:0.9rem;">
                        <span>${formatDate(post.createdAt)}</span>
                        <span>#${post.id}</span>
                    </div>
                </div>
            `).join('');
            
            // æ›´æ–°ç»Ÿè®¡
            document.getElementById('postsCount').textContent = posts.length;
        }

        // æ¸²æŸ“æœåŠ¡å™¨
        function renderServers() {
            const container = document.getElementById('serversGrid');
            if (!container) return;
            
            if (servers.length === 0) {
                container.innerHTML = `
                    <div style="grid-column:1/-1;text-align:center;padding:40px;">
                        <i class="fas fa-server" style="font-size:3rem;color:#666;margin-bottom:15px;"></i>
                        <p>è¿˜æ²¡æœ‰æœåŠ¡å™¨ï¼Œæ·»åŠ ä¸€ä¸ªå§ï¼</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = servers.map(server => `
                <div class="card">
                    <div class="card-header">
                        <strong>${server.name}</strong>
                        <span class="badge ${server.platform === 'java' ? 'badge-java' : 'badge-bedrock'}">
                            ${server.platform === 'java' ? 'Javaç‰ˆ' : 'åŸºå²©ç‰ˆ'}
                        </span>
                    </div>
                    <div style="background:rgba(0,0,0,0.3);padding:10px;border-radius:5px;margin:10px 0;font-family:monospace;">
                        ${server.ip}
                    </div>
                    <p style="color:#ccc;margin-bottom:15px;">${server.description}</p>
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <span style="color:#888;font-size:0.9rem;">${server.author}</span>
                        <button class="btn btn-small" onclick="copyToClipboard('${server.ip}')">
                            <i class="fas fa-copy"></i> å¤åˆ¶IP
                        </button>
                    </div>
                </div>
            `).join('');
            
            // æ›´æ–°ç»Ÿè®¡
            document.getElementById('serversCount').textContent = servers.length;
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats(stats) {
            document.getElementById('postsCount').textContent = stats.posts || 0;
            document.getElementById('serversCount').textContent = stats.servers || 0;
            document.getElementById('usersCount').textContent = stats.users || 0;
        }

        // æäº¤å†…å®¹
        async function submitContent() {
            if (!currentUser) {
                showToast('è¯·å…ˆç™»å½•', 'error');
                openLoginModal();
                return;
            }

            const type = document.getElementById('contentType').value;
            const platform = document.querySelector('input[name="platform"]:checked').value;

            if (type === 'post') {
                const title = document.getElementById('postTitle').value.trim();
                const content = document.getElementById('postContent').value.trim();

                if (!title || !content) {
                    showToast('è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹', 'error');
                    return;
                }

                try {
                    const response = await fetch(API_BASE + '/posts', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            title,
                            content,
                            platform,
                            author: currentUser.username
                        })
                    });

                    if (response.ok) {
                        const newPost = await response.json();
                        posts.unshift(newPost);
                        renderPosts();
                        document.getElementById('postTitle').value = '';
                        document.getElementById('postContent').value = '';
                        showToast('å¸–å­å‘å¸ƒæˆåŠŸï¼');
                        switchTab('posts');
                    }
                } catch (error) {
                    // æ¨¡æ‹ŸæˆåŠŸ
                    const newPost = {
                        id: Date.now(),
                        title,
                        content,
                        platform,
                        author: currentUser.username,
                        createdAt: new Date().toISOString()
                    };
                    posts.unshift(newPost);
                    renderPosts();
                    showToast('å¸–å­å‘å¸ƒæˆåŠŸï¼ˆæ¨¡æ‹Ÿï¼‰');
                    switchTab('posts');
                }
            } else {
                const name = document.getElementById('serverName').value.trim();
                const ip = document.getElementById('serverIP').value.trim();
                const description = document.getElementById('serverDesc').value.trim();

                if (!name || !ip || !description) {
                    showToast('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'error');
                    return;
                }

                try {
                    const response = await fetch(API_BASE + '/servers', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            name,
                            ip,
                            description,
                            platform,
                            author: currentUser.username
                        })
                    });

                    if (response.ok) {
                        const newServer = await response.json();
                        servers.unshift(newServer);
                        renderServers();
                        document.getElementById('serverName').value = '';
                        document.getElementById('serverIP').value = '';
                        document.getElementById('serverDesc').value = '';
                        showToast('æœåŠ¡å™¨æ·»åŠ æˆåŠŸï¼');
                        switchTab('servers');
                    }
                } catch (error) {
                    // æ¨¡æ‹ŸæˆåŠŸ
                    const newServer = {
                        id: Date.now(),
                        name,
                        ip,
                        description,
                        platform,
                        author: currentUser.username,
                        createdAt: new Date().toISOString()
                    };
                    servers.unshift(newServer);
                    renderServers();
                    showToast('æœåŠ¡å™¨æ·»åŠ æˆåŠŸï¼ˆæ¨¡æ‹Ÿï¼‰');
                    switchTab('servers');
                }
            }
        }

        // ç”¨æˆ·ç™»å½•
        async function userLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();

            if (!username || !password) {
                showToast('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ', 'error');
                return;
            }

            try {
                const response = await fetch(API_BASE + '/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        currentUser = data.user;
                        localStorage.setItem('mc_user', JSON.stringify(currentUser));
                        updateUserUI();
                        closeModal();
                        showToast('ç™»å½•æˆåŠŸï¼');
                        document.getElementById('username').value = '';
                        document.getElementById('password').value = '';
                    } else {
                        showToast(data.message || 'ç™»å½•å¤±è´¥', 'error');
                    }
                } else {
                    // æ¨¡æ‹Ÿç™»å½•æˆåŠŸ
                    currentUser = { username, id: Date.now() };
                    localStorage.setItem('mc_user', JSON.stringify(currentUser));
                    updateUserUI();
                    closeModal();
                    showToast('æ¨¡æ‹Ÿç™»å½•æˆåŠŸ');
                }
            } catch (error) {
                console.error('ç™»å½•é”™è¯¯:', error);
                // æ¨¡æ‹Ÿç™»å½•
                currentUser = { username: username || 'ç©å®¶', id: Date.now() };
                localStorage.setItem('mc_user', JSON.stringify(currentUser));
                updateUserUI();
                closeModal();
                showToast('æ¨¡æ‹Ÿç™»å½•æˆåŠŸï¼ˆç½‘ç»œé”™è¯¯ï¼‰');
            }
        }

        // ç”¨æˆ·æ³¨å†Œ
        async function userRegister() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();

            if (!username || !password) {
                showToast('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ', 'error');
                return;
            }

            if (password.length < 6) {
                showToast('å¯†ç è‡³å°‘6ä½', 'error');
                return;
            }

            try {
                const response = await fetch(API_BASE + '/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        showToast('æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•');
                        document.getElementById('username').value = '';
                        document.getElementById('password').value = '';
                    } else {
                        showToast(data.message || 'æ³¨å†Œå¤±è´¥', 'error');
                    }
                } else {
                    showToast('æ¨¡æ‹Ÿæ³¨å†ŒæˆåŠŸ');
                }
            } catch (error) {
                console.error('æ³¨å†Œé”™è¯¯:', error);
                showToast('æ³¨å†ŒåŠŸèƒ½éœ€è¦åç«¯API', 'warning');
            }
        }

        // é€€å‡ºç™»å½•
        function logout() {
            localStorage.removeItem('mc_user');
            currentUser = null;
            updateUserUI();
            showToast('å·²é€€å‡ºç™»å½•');
        }

        // æ‰“å¼€ç™»å½•æ¨¡æ€æ¡†
        function openLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('loginModal').style.display = 'none';
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text)
                .then(() => showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'))
                .catch(() => {
                    const textarea = document.createElement('textarea');
                    textarea.value = text;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                });
        }

        // æ˜¾ç¤ºæç¤º
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.background = type === 'error' ? '#e74c3c' : '#3b8526';
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'åˆšåˆš';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'åˆ†é’Ÿå‰';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'å°æ—¶å‰';
            
            return date.toLocaleDateString('zh-CN');
        }
    </script>
</body>
</html>